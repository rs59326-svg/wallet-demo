<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wallet Demo</title>
  <style>
    :root{--bd:#e5e7eb;--fg:#111827;--muted:#6b7280;--bg:#f8fafc;--white:#fff;--blue:#2563eb;--green:#059669;--red:#dc2626;}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",Arial;background:var(--bg);color:var(--fg)}
    .shell{max-width:920px;margin:0 auto;padding:16px 16px 96px}
    .card{background:var(--white);border:1px solid var(--bd);border-radius:16px;padding:16px;box-shadow:0 1px 2px rgba(0,0,0,.03);margin-bottom:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap}.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .btn{border:1px solid var(--bd);background:var(--white);border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--blue);border-color:var(--blue);color:#fff}
    .btn.success{background:var(--green);border-color:var(--green);color:#fff}
    .input{width:100%;border:1px solid var(--bd);border-radius:12px;padding:10px 12px}
    .label{display:block;color:var(--muted);font-size:12px;margin:6px 0 4px}
    .balance{font-size:32px;font-weight:800}
    .tx{display:flex;align-items:center;justify-content:space-between;border-top:1px dashed var(--bd);padding:10px 0}
    .tx:first-child{border-top:none}.tx-amt{font-weight:700}.pos{color:var(--green)}.neg{color:var(--red)}
    .tabs{position:fixed;left:0;right:0;bottom:12px;margin:0 auto;max-width:920px;display:grid;grid-template-columns:repeat(6,1fr);gap:8px;padding:0 16px}
    .tab{background:var(--white);border:1px solid var(--bd);border-radius:12px;padding:8px;display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer}
    .tab.active{outline:2px solid var(--blue)} .muted{color:var(--muted);font-size:13px}
    @media(max-width:560px){.grid2{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="shell" id="app">Loading‚Ä¶</div>
  <script>
    const STORAGE_KEY="wallet_demo_local";
    const fmt=(n)=>new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB"}).format(n);
    const uid=()=>Math.random().toString(36).slice(2,10);
    const now=()=>new Date().toISOString();
    const seed=[{id:uid(),type:"topup",amount:500,note:"‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å",createdAt:now()},
                {id:uid(),type:"pay",amount:-120,note:"Coffee Shop",createdAt:now()},
                {id:uid(),type:"transfer",amount:-220,note:"Rent split to @mook",createdAt:now()}];

    let state=(()=>{try{const s=localStorage.getItem(STORAGE_KEY);
      return s?JSON.parse(s):{user:{id:"user_001",name:"You"},balance:160,transactions:seed};}
      catch{return {user:{id:"user_001",name:"You"},balance:160,transactions:seed};}})();

    const save=()=>localStorage.setItem(STORAGE_KEY,JSON.stringify(state));
    const addTx=(tx)=>{state={...state,balance:+(state.balance+tx.amount).toFixed(2),
      transactions:[{...tx,id:uid(),createdAt:now()},...state.transactions]};save();render();};
    const moneyFrom=(v)=>{const n=parseFloat(String(v).replace(/[^\d.-]/g,""));return Number.isFinite(n)?n:0;};
    const route=(to)=>{state.route=to;render();};
    const txIcon=(t)=>t.type==="topup"?"‚ûï":t.type==="pay"?"üí≥":t.type==="transfer"?"üîÅ":"üìÑ";

    const viewHome=()=>{const {balance,transactions}=state;return `
      <div class="card"><h3>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏ï</h3>
        <div class="balance">${fmt(balance)}</div>
        <div class="row" style="margin-top:12px">
          <button class="btn" data-go="pay">üí≥ ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô</button>
          <button class="btn" data-go="scan">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô</button>
          <button class="btn" data-go="transfer">üîÅ ‡πÇ‡∏≠‡∏ô</button>
          <button class="btn" data-go="topup">‚ûï ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>
      </div>
      <div class="card"><h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        ${transactions.slice(0,8).map(t=>`
          <div class="tx">
            <div><div><b>${txIcon(t)}</b> ${t.note||t.type}</div>
            <div class="muted">${new Date(t.createdAt).toLocaleString("th-TH")}</div></div>
            <div class="tx-amt ${t.amount>=0?"pos":"neg"}">${t.amount>=0?"+":""}${fmt(t.amount)}</div>
          </div>`).join("")}
      </div>`;};

    const viewPay=()=>`
      <div class="card"><h3>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏à‡∏≥‡∏•‡∏≠‡∏á)</h3>
        <label class="label">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</label><input class="input" id="pay_merchant" value="‡∏£‡πâ‡∏≤‡∏ô‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏ã‡∏∑‡πâ‡∏≠"/>
        <label class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (THB)</label><input class="input" id="pay_amount" type="number" value="100" inputmode="decimal"/>
        <div class="row" style="margin-top:10px"><button class="btn" data-go="home">‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn primary" id="pay_submit">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞</button></div></div>`;

    const viewTransfer=()=>`
      <div class="card"><h3>‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏à‡∏≥‡∏•‡∏≠‡∏á)</h3>
        <label class="label">‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (@username ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏ö‡∏≠‡∏£‡πå)</label><input class="input" id="tr_to" value="@friend"/>
        <label class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (THB)</label><input class="input" id="tr_amount" type="number" value="50" inputmode="decimal"/>
        <label class="label">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥ (‡∏≠‡∏≠‡∏õ‡∏ä‡∏±‡∏ô)</label><input class="input" id="tr_note" value="‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô"/>
        <div class="row" style="margin-top:10px"><button class="btn" data-go="home">‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn primary" id="tr_submit">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</button></div></div>`;

    const viewTopup=()=>`
      <div class="card"><h3>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏ï (‡∏à‡∏≥‡∏•‡∏≠‡∏á)</h3>
        <label class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (THB)</label><input class="input" id="tu_amount" type="number" value="300" inputmode="decimal"/>
        <label class="label">‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤</label><input class="input" id="tu_src" value="‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏î‡∏ö‡∏¥‡∏ï"/>
        <div class="row" style="margin-top:10px"><button class="btn" data-go="home">‡∏Å‡∏•‡∏±‡∏ö</button>
        <button class="btn success" id="tu_submit">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</button></div></div>`;

    const viewScan=()=>`
      <div class="card"><h3>‡∏™‡πÅ‡∏Å‡∏ô QR (‡∏à‡∏≥‡∏•‡∏≠‡∏á)</h3>
        <div class="muted">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: <code>alipay://pay?m=Coffee&amt=120</code></div>
        <label class="label">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏Ñ‡πâ‡∏î</label><input class="input" id="sc_code" placeholder="alipay://pay?m=Coffee&amt=120"/>
        <div class="grid2" style="margin-top:8px">
          <div><label class="label">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</label><input class="input" id="sc_merchant" placeholder="Coffee Shop"/></div>
          <div><label class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (THB)</label><input class="input" id="sc_amount" type="number" inputmode="decimal" placeholder="120"/></div>
        </div>
        <div class="row" style="margin-top:10px"><button class="btn" id="sc_decode">‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™</button>
        <button class="btn primary" id="sc_pay">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button><button class="btn" data-go="home">‡∏Å‡∏•‡∏±‡∏ö</button></div>
      </div>`;

    const viewProfile=()=>{const {user,balance,transactions}=state;
      const totalIn=transactions.filter(t=>t.amount>0).reduce((s,t)=>s+t.amount,0);
      const totalOut=transactions.filter(t=>t.amount<0).reduce((s,t)=>s+Math.abs(t.amount),0);
      return `
      <div class="card"><h3>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
        <div class="row" style="align-items:center">
          <div style="width:56px;height:56px;border-radius:50%;background:#dbeafe;display:flex;align-items:center;justify-content:center;font-size:24px">üí†</div>
          <div><div style="font-weight:700">${user.name}</div><div class="muted">User ID: ${user.id}</div></div>
        </div>
        <div class="grid2" style="margin-top:12px">
          <div><div class="muted">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div><div class="balance">${fmt(balance)}</div></div>
          <div><div class="muted">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö/‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div><div><b class="pos">${fmt(totalIn)}</b> / <b class="neg">-${fmt(totalOut)}</b></div></div>
        </div>
        <div class="row" style="margin-top:10px"><button class="btn" id="reset_demo">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏î‡πÇ‡∏°</button></div>
      </div>
      <div class="card"><h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        ${transactions.map(t=>`
          <div class="tx">
            <div><div><b>${txIcon(t)}</b> ${t.note||t.type}</div>
            <div class="muted">${new Date(t.createdAt).toLocaleString("th-TH")}</div></div>
            <div class="tx-amt ${t.amount>=0?"pos":"neg"}">${t.amount>=0?"+":""}${fmt(t.amount)}</div>
          </div>`).join("")}
      </div>`;};

    const toolbar=(active)=>{const items=[["home","üè†","‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å"],["pay","üí≥","‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô"],["transfer","üîÅ","‡πÇ‡∏≠‡∏ô"],["topup","‚ûï","‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô"],["scan","üì∑","‡∏™‡πÅ‡∏Å‡∏ô"],["profile","üë§","‡∏â‡∏±‡∏ô"]];
      return `<div class="tabs">${items.map(([r,i,l])=>`<button class="tab ${active===r?"active":""}" data-go="${r}"><span>${i}</span><span style="font-size:12px">${l}</span></button>`).join("")}</div>`;};

    function render(){
      const el=document.getElementById("app");
      const r=state.route||"home";
      let v=""; if(r==="home")v=viewHome(); else if(r==="pay")v=viewPay(); else if(r==="transfer")v=viewTransfer();
      else if(r==="topup")v=viewTopup(); else if(r==="scan")v=viewScan(); else if(r==="profile")v=viewProfile();
      el.innerHTML=`${v}${toolbar(r)}`;

      el.querySelectorAll("[data-go]").forEach(b=>b.onclick=()=>route(b.getAttribute("data-go")));

      const pay=document.getElementById("pay_submit");
      if(pay) pay.onclick=()=>{const m=document.getElementById("pay_merchant").value.trim()||"‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤";
        const amt=Math.max(0,moneyFrom(document.getElementById("pay_amount").value));
        if(!amt)return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"); if(amt>state.balance)return alert("‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");
        addTx({type:"pay",amount:-amt,note:m});};

      const tr=document.getElementById("tr_submit");
      if(tr) tr.onclick=()=>{const to=document.getElementById("tr_to").value.trim()||"@user";
        const amt=Math.max(0,moneyFrom(document.getElementById("tr_amount").value));
        const note=document.getElementById("tr_note").value.trim()||"Transfer";
        if(!amt)return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"); if(amt>state.balance)return alert("‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");
        addTx({type:"transfer",amount:-amt,note:`${note} to ${to}`});};

      const tu=document.getElementById("tu_submit");
      if(tu) tu.onclick=()=>{const src=document.getElementById("tu_src").value.trim()||"‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏î‡∏ö‡∏¥‡∏ï";
        const amt=Math.max(0,moneyFrom(document.getElementById("tu_amount").value));
        if(!amt)return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"); addTx({type:"topup",amount:+amt,note:`Top-up via ${src}`});};

      const scD=document.getElementById("sc_decode");
      if(scD) scD.onclick=()=>{try{const u=new URL(document.getElementById("sc_code").value.trim());
        document.getElementById("sc_merchant").value=u.searchParams.get("m")||"";
        document.getElementById("sc_amount").value=u.searchParams.get("amt")||"";}
        catch{alert("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: alipay://pay?m=Coffee&amt=120)");}};

      const scP=document.getElementById("sc_pay");
      if(scP) scP.onclick=()=>{const m=document.getElementById("sc_merchant").value.trim()||"QR Payment";
        const amt=Math.max(0,moneyFrom(document.getElementById("sc_amount").value));
        if(!amt)return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"); if(amt>state.balance)return alert("‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");
        addTx({type:"pay",amount:-amt,note:m});};

      const rs=document.getElementById("reset_demo");
      if(rs) rs.onclick=()=>{localStorage.removeItem(STORAGE_KEY);
        state={user:{id:"user_001",name:"You"},balance:160,transactions:seed}; save(); render();};
    }
    document.title="Wallet Demo";
    render();
  </script>
</body>
</html>

